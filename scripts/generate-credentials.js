/* eslint-disable @typescript-eslint/no-require-imports */
/* eslint-disable @typescript-eslint/no-var-requires */
const crypto = require('crypto');
let ethers;
try {
  ethers = require('ethers');
} catch (e) {
  console.log('ethers not found. Install with: npm install ethers');
  process.exit(1);
}

const encryptionKey = crypto.randomBytes(32).toString('hex');
const nextAuthSecret = crypto.randomBytes(32).toString('hex');
const adminWallet = ethers.Wallet.createRandom();
const testWallet = ethers.Wallet.createRandom();

const envContent = `# Generated by HealthChain credential generator
# ${new Date().toISOString()}

DATABASE_URL="your_mongodb_connection_string"
NEXTAUTH_SECRET="${nextAuthSecret}"
ENCRYPTION_KEY="${encryptionKey}"
INFURA_PROJECT_ID="your_infura_project_id_here"
INFURA_PROJECT_SECRET="your_infura_project_secret_here"
NEXT_PUBLIC_RPC_URL="https://sepolia.infura.io/v3/YOUR_INFURA_PROJECT_ID"
NEXT_PUBLIC_IPFS_URL="https://ipfs.infura.io:5001/api/v0"
NEXT_PUBLIC_CHAIN_ID="11155111"
NEXT_PUBLIC_EXPLORER_URL="https://sepolia.etherscan.io"
ADMIN_PRIVATE_KEY="${adminWallet.privateKey}"
NEXT_PUBLIC_CONTRACT_ADDRESS=""
`;

console.log('ENCRYPTION_KEY="' + encryptionKey + '"');
console.log('NEXTAUTH_SECRET="' + nextAuthSecret + '"');
console.log('ADMIN_PRIVATE_KEY="' + adminWallet.privateKey + '"');
console.log('# Admin Address: ' + adminWallet.address);
console.log('# Test Address: ' + testWallet.address);
console.log('# Test Private Key: ' + testWallet.privateKey);
console.log('');
console.log('Copy the following to your .env.local and fill in your Infura credentials:');
console.log(envContent);

const fs = require('fs');
try {
  fs.writeFileSync('.env.template', envContent);
  console.log('Template saved to .env.template');
} catch (error) {
  console.log('Could not save template file (permissions issue)');
}