// scripts/generate-credentials.js
// Run with: node scripts/generate-credentials.js

const crypto = require('crypto');

// Check if ethers is available
let ethers;
try {
  ethers = require('ethers');
} catch (e) {
  console.log('‚ö†Ô∏è  ethers not found. Install with: npm install ethers');
  process.exit(1);
}

console.log('üîê HEALTHCHAIN CREDENTIALS GENERATOR');
console.log('=====================================\n');

// 1. Generate encryption key
const encryptionKey = crypto.randomBytes(32).toString('hex');
console.log('üì¶ ENCRYPTION KEY (for IPFS file encryption):');
console.log(`ENCRYPTION_KEY="${encryptionKey}"`);
console.log('');

// 2. Generate NextAuth secret
const nextAuthSecret = crypto.randomBytes(32).toString('hex');
console.log('üîë NEXTAUTH SECRET (for session management):');
console.log(`NEXTAUTH_SECRET="${nextAuthSecret}"`);
console.log('');

// 3. Generate admin wallet
const adminWallet = ethers.Wallet.createRandom();
console.log('üëë ADMIN WALLET (for server-side blockchain operations):');
console.log(`ADMIN_PRIVATE_KEY="${adminWallet.privateKey}"`);
console.log(`# Admin Address: ${adminWallet.address}`);
console.log('# ‚ö†Ô∏è  Fund this address with Sepolia ETH from faucets!');
console.log('');

// 4. Generate a test user wallet
const testWallet = ethers.Wallet.createRandom();
console.log('üß™ TEST USER WALLET (for testing):');
console.log(`# Test Address: ${testWallet.address}`);
console.log(`# Test Private Key: ${testWallet.privateKey}`);
console.log('# Import this into MetaMask for testing');
console.log('');

// 5. Complete environment file template
console.log('üìÑ COMPLETE .env.local FILE TEMPLATE:');
console.log('=====================================');
console.log(`# Database (keep your existing value)
DATABASE_URL="your_mongodb_connection_string"

# Generated secrets
NEXTAUTH_SECRET="${nextAuthSecret}"
ENCRYPTION_KEY="${encryptionKey}"

# Infura credentials (get from https://infura.io)
INFURA_PROJECT_ID="your_infura_project_id_here"
INFURA_PROJECT_SECRET="your_infura_project_secret_here"

# Blockchain configuration
NEXT_PUBLIC_RPC_URL="https://sepolia.infura.io/v3/YOUR_INFURA_PROJECT_ID"
NEXT_PUBLIC_IPFS_URL="https://ipfs.infura.io:5001/api/v0"
NEXT_PUBLIC_CHAIN_ID="11155111"
NEXT_PUBLIC_EXPLORER_URL="https://sepolia.etherscan.io"

# Admin wallet (fund with Sepolia ETH)
ADMIN_PRIVATE_KEY="${adminWallet.privateKey}"

# Contract address (will be set after deployment)
NEXT_PUBLIC_CONTRACT_ADDRESS=""
`);

console.log('\nüöÄ NEXT STEPS:');
console.log('===============');
console.log('1. Copy the .env.local template above to your .env.local file');
console.log('2. Get Infura credentials:');
console.log('   - Go to https://infura.io');
console.log('   - Create account and new project');
console.log('   - Copy Project ID and Project Secret');
console.log('3. Get Sepolia test ETH:');
console.log(`   - Add admin address to MetaMask: ${adminWallet.address}`);
console.log('   - Visit https://sepoliafaucet.com/');
console.log('   - Request test ETH for admin address');
console.log('4. Install dependencies:');
console.log('   npm install ethers kubo-rpc-client');
console.log('5. Test the setup:');
console.log('   npm run dev');
console.log('   Visit http://localhost:3000/test-wallet');
console.log('');

console.log('üí° SECURITY REMINDERS:');
console.log('======================');
console.log('- Never commit .env.local to version control');
console.log('- Use different keys for production');
console.log('- Keep private keys secure');
console.log('- These are test credentials - not for mainnet!');
console.log('');

// Save to file option
const fs = require('fs');
const envContent = `# Generated by HealthChain credential generator
# ${new Date().toISOString()}

# Database (keep your existing value)
DATABASE_URL="your_mongodb_connection_string"

# Generated secrets
NEXTAUTH_SECRET="${nextAuthSecret}"
ENCRYPTION_KEY="${encryptionKey}"

# Infura credentials (get from https://infura.io)
INFURA_PROJECT_ID="your_infura_project_id_here"
INFURA_PROJECT_SECRET="your_infura_project_secret_here"

# Blockchain configuration
NEXT_PUBLIC_RPC_URL="https://sepolia.infura.io/v3/YOUR_INFURA_PROJECT_ID"
NEXT_PUBLIC_IPFS_URL="https://ipfs.infura.io:5001/api/v0"
NEXT_PUBLIC_CHAIN_ID="11155111"
NEXT_PUBLIC_EXPLORER_URL="https://sepolia.etherscan.io"

# Admin wallet (fund with Sepolia ETH)
ADMIN_PRIVATE_KEY="${adminWallet.privateKey}"

# Contract address (will be set after deployment)
NEXT_PUBLIC_CONTRACT_ADDRESS=""
`;

try {
  fs.writeFileSync('.env.template', envContent);
  console.log('‚úÖ Template saved to .env.template');
  console.log('   Copy this to .env.local and fill in your Infura credentials');
} catch (error) {
  console.log('‚ö†Ô∏è  Could not save template file (permissions issue)');
}